+++
title = "08. Take Action on GuardDuty findings"
date = 2019-11-18T08:23:04+11:00
weight = 30
chapter = false
+++

[AWS Security Hub](https://docs.aws.amazon.com/securityhub/latest/userguide/what-is-securityhub.html), [Amazon GuardDuty](https://aws.amazon.com/guardduty/), and [AWS Identity and Access Management Access Analyzer](https://aws.amazon.com/iam/features/analyze-access/) are managed AWS services that provide you with actionable findings in your AWS accounts. They are easy to turn on and can integrate across multiple accounts. Turning them on is the first step. You also need to take action when you see findings. The action(s) to take are determined by your own incident response policy. For each finding, ensure that you have determined what your required response actions should be.

Action can be notifying a human to respond, but as you get more experienced in AWS services, [you will want to automate](https://aws.amazon.com/blogs/security/how-get-started-security-response-automation-aws/) the response to the findings generated by Security Hub or GuardDuty. Learn more about [how to automate your response and remediation from Security Hub findings](https://aws.amazon.com/blogs/security/automated-response-and-remediation-with-aws-security-hub/).

In this lab, you will learn how to create notifications for GuardDuty findings and centralise all GuardDuty findings from multiple AWS accounts into a GuardDuty delegated administrator. 

### Centralise GuardDuty findings from multiple accounts to a delegated GuardDuty Administrator 

To manage multiple accounts in Amazon GuardDuty, you must choose a single AWS account to be the administrator account for GuardDuty. You can then associate other AWS accounts with the administrator account as member accounts. 

There are 2 options to do this: 
* Managing multiple accounts with AWS Organizations. 
* Managing accounts by invitation if not using AWS Organizations. 

### Managing multiple accounts with AWS Organizations

Please note that if using this option you will need to use an IAM user or role in the management account with [sufficient permissions.](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_organizations.html).

If the account that you want to specify as the GuardDuty administrator account is part of an organization in AWS Organizations, then you can specify that account as the organization's delegated administrator for GuardDuty. The account that is registered as the delegated administrator automatically becomes the GuardDuty administrator account.
You can use this administrator account to enable and manage GuardDuty for any account in the organization when you add that account as a member account. 

1. From the AWS console, click *Services* and select *Amazon GuardDuty*. 
2. If GuardDuty is not already enabled, you can select *Get Started* and then designate a GuardDuty delegated administrator on the *Welcome to GuardDuty* page.
3. On the left hand side, select *Settings*. 

![Select Settings](/images/Module-8-Image-1.png)

4. Enter the twelve-digit AWS account ID of the account that you want to designate as the GuardDuty delegated administrator for the organization.

![Enter the AWS Account ID](/images/Module-8-Image-2.png)

5. Choose *Delegate*. If GuardDuty is not already enabled, designating a delegated administrator will enable GuardDuty for that account in your current Region.

6.  Repeat the previous steps in each AWS Region.

7. After you designate the delegated administrator, you only need to use the organization management account to change or remove the delegated administrator account.
8. All accounts which have GuardDuty enabled in your Organization will automatically send GuardDuty findings to this Delegated Administrator account. 

For more information refer to our [documentation](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_accounts.html)

### Managing multiple GuardDuty accounts through Invitation 

To manage accounts outside of your organization, you can use the legacy invitation method. When you use this method, your account is designated as a administrator account when another account accepts your invitation to become a member account.

1. From the AWS console, click *Services* and select *Amazon GuardDuty*
2. In the left hand side, choose *Accounts*. 

![Choose Accounts](/images/Module-8-Image-3.png)

3. Select *Add Accounts*.

![Select Add Accounts](/images/Module-8-Image-4.png)

4. On the *Add member accounts* page, under *Enter accounts*, enter the AWS account ID and email address of the account that you want to add. Then choose *Add*.

![Enter the AWS account ID](/images/Module-8-Image-5.png)

5. You can add more accounts, one at a time, by specifying their IDs and email addresses. You can also choose *Upload list (.csv)* to bulk add accounts. 
6. When you are finished adding accounts, choose *Next*.
7. The added accounts appear in a list on the *Accounts* page. Each added account in this list has an *Invite* link in the *Status* column.
8. In the navigation pane, choose *Accounts*.
9. For the account that you want to invite to enable GuardDuty, choose the *Invite* link that appears in the *Status* column of the added accounts list.

![Choose the invite link](/images/Module-8-Image-6.png)

10. In the *Invitation to GuardDuty* dialog box, enter an invitation message (optional), and then choose *Send notification*.
11. Your invited account will now need to accept the invitation. 
12. Log into your invited account. 
13. Click on *Accept Invitation* to accept the membership invitation. 
14. After you accept the invitation, your account becomes a GuardDuty member account, and findings from this account is automatically sent to the delegated administrator account. 
15. Repeat this for all accounts you wish to invite as members. 

For more information refer to our [documentation.](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_invitations.html)

### Configure CloudWatch Events Rule for GuardDuty to send custom SNS notifications for GuardDuty findings. 

You can use CloudWatch Events with GuardDuty to set up automated finding alerts by sending GuardDuty finding events to a messaging hub to help increase the visibility of GuardDuty findings. You can also configure notifications in messaging channels such as Slack. 

1. From the AWS console, click *Services* and select *Amazon Simple Notification Service*.
2. Select *Topics* from the navigation pane and then *Create Topic*.

![Select Topics](/images/Module-8-Image-7.png)

3. In the Create topic section, select *Standard*. Next, enter a Topic name, for example GuardDuty_to_Email. Other details are optional.

![Create topic](/images/Module-8-Image-8.png)

4. Choose *Create Topic*. The Topic details for your new topic will open.
5. In the Subscriptions section select *Create Subscription*

![Create subscription](/images/Module-8-Image-9.png)

6. From the *Protocol* menu, select *Email*.

![Select email](/images/Module-8-Image-10.png)

7. In the *Endpoint* field add the email address you would like to receive notifications at.
8. Choose *Create subscription*
9. Check for a subscription message in your inbox and choose *Confirm Subscription. *
10. From the AWS console, click *Services* and select *Amazon CloudWatch*.
11. Select *Rules* from the navigation pane and then *Create Rule*.

![Select Rules](/images/Module-8-Image-11.png)

12. From the *Service Name* menu, choose *GuardDuty*.
13. From the *Event Type* menu, choose *GuardDuty Finding*.

![Choose GuardDuty Finding](/images/Module-8-Image-12.png)

You may also choose to limit the severity of GuardDuty findings that you wish to receive alerts for. More details can be found [here.](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings_cloudwatch.html)


14. In the *Targets* section click *Add Target*.

15. From the *Select Targets* menu, choose *SNS Topic*.

16. For *Select Topic* select the name of the SNS Topic you created in Step 1.
17. Expand *Configure input* and then choose *Input Transformer*.
18. Copy the following code and paste it into the *Input Path* field.

        {
        "severity": "$.detail.severity",
        "Account_ID": "$.detail.accountId",
        "Finding_ID": "$.detail.id",
        "Finding_Type": "$.detail.type",
        "region": "$.region",
        "Finding_description": "$.detail.description"
        }


19. Copy the following code and paste it into the *Input Template* field to format the email.

        "AWS <Account_ID> has a severity <severity> GuardDuty finding type <Finding_Type> in the <region> region."
        "Finding Description:"
        "<Finding_description>. "
        "For more details open the GuardDuty console at https://console.aws.amazon.com/guardduty/home?region=#/findings?search=id= (https://console.aws.amazon.com/guardduty/home?region=%3Cregion%3E#/findings?search=id=%3CFinding_ID)>â€œ

![Input Template Code](/images/Module-8-Image-13.png)

20. Click *Configure Details*.
23. In the *Configure rule details* page, enter a *Name* and *Description* for the rule, and then choose *Create Rule*.
24. Your GuardDuty findings will now be sent to the email address that you had specified in the step above. 

For more information refer to the documentation [here](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings_cloudwatch.html)